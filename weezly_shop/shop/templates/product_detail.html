{% extends 'base.html' %} {% block content %}

<div class="container py-5">
    <div class="row">
        <!-- Product Image -->
        <div class="col-lg-6 mb-4 mb-lg-0">
            <div class="product-image-container rounded shadow-sm overflow-hidden bg-light d-flex align-items-center justify-content-center" style="height: 500px">
                <img class="product-image img-fluid" style="max-height: 100%; object-fit: contain" src="{{ product.image.url }}" alt="{{ product.title }}" />
            </div>
        </div>

        <!-- Product Details -->
        <div class="col-lg-6">
            <div class="product-details p-4 rounded shadow-sm bg-white">
                <!-- Category -->
                <div class="mb-3">
                    <a class="text-decoration-none text-muted small" href="{% url 'shop:filter_by_category' product.category.slug %}">
                        <span class="category-icon me-1">
                            <i class="bi bi-tag-fill"></i>
                        </span>
                        {{product.category}}
                    </a>
                </div>

                <!-- Title -->
                <h1 class="product-title fw-bold mb-4">{{ product.title }}</h1>

                <!-- Price -->
                <div class="product-price mb-4">
                    <span class="fs-2 fw-bold text-primary">${{ product.price }}</span>
                </div>

                <!-- Description -->
                <div class="product-description mb-4 text-muted">{{ product.description }}</div>

                <hr class="my-4" />

                <!-- Add to Cart Form -->
                <div class="d-flex flex-wrap gap-2 mb-4">
                    <form method="post" action="{% url 'cart:add_to_cart' product.id %}" class="d-flex flex-grow-1">
                        {% csrf_token %}
                        <div class="input-group">
                            {{ form }}
                            <button type="submit" class="btn btn-primary px-4"><i class="bi bi-cart-plus me-2"></i>Add to Cart</button>
                        </div>
                    </form>

                    <!-- Favorites Button -->
                    {% if favorites == 'remove' %}
                    <a href="{% url 'shop:remove_from_favorites' product.id %}" class="btn btn-danger" title="Remove from favorites">
                        <i class="bi bi-heart-fill me-0 mt-3"></i>
                    </a>
                    {% else %}
                    <a href="{% url 'shop:add_to_favorites' product.id %}" class="btn btn-outline-secondary" title="Add to favorites">
                        <i class="bi bi-heart me-0"></i>
                    </a>
                    {% endif %}
                </div>

                <!-- Price Tracking -->
                {% if user.is_authenticated %} {% if price_tracking %}
                <div class="price-tracking-info card border-info mb-4">
                    <div class="card-header bg-info bg-opacity-10 d-flex justify-content-between align-items-center">
                        <span class="fw-bold">Price Tracking Active</span>
                        <i class="bi bi-bell-fill text-info"></i>
                    </div>
                    <div class="card-body">
                        <div class="d-flex justify-content-between mb-2">
                            <span>Your target price:</span>
                            <span class="fw-bold">${{ price_tracking.desired_price|floatformat:0 }}</span>
                        </div>
                        <div class="d-flex justify-content-between">
                            <span>Current price:</span>
                            <span class="fw-bold">${{ product.price }}</span>
                        </div>

                        <!-- Cancel tracking button -->
                        <form method="post" action="{% url 'shop:cancel_price_tracking' product.id %}" class="mt-3">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-sm btn-outline-danger w-100"><i class="bi bi-x-circle me-1"></i>Cancel Price Tracking</button>
                        </form>
                    </div>
                </div>
                {% else %}
                <div class="card border-light mb-4">
                    <div class="card-header bg-light"><i class="bi bi-bell me-2"></i>Track Price</div>
                    <div class="card-body">
                        <form method="post">
                            {% csrf_token %}
                            <div class="mb-3">
                                <label for="desired_price" class="form-label">Notify me when price drops to:</label>
                                <div class="input-group">
                                    <span class="input-group-text">$</span>
                                    <input
                                        type="number"
                                        name="desired_price"
                                        id="desired_price"
                                        step="1"
                                        min="0"
                                        class="form-control"
                                        placeholder="{{ product.price|floatformat:0 }}"
                                        required
                                    />
                                </div>
                                <div class="form-text">Current price: ${{ product.price }}</div>
                            </div>
                            <button type="submit" class="btn btn-outline-primary w-100"><i class="bi bi-bell me-2"></i>Notify Me</button>
                        </form>
                    </div>
                </div>
                {% endif %} {% else %}
                <div class="alert alert-light border d-flex align-items-center gap-2">
                    <i class="bi bi-info-circle text-primary"></i>
                    <div><a href="{% url 'login' %}" class="alert-link">Sign in</a> to track the price of this item.</div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Related Products -->
    <div class="related-products mt-5">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h3 class="fw-bold m-0">Related Products</h3>
            <a href="{% url 'shop:filter_by_category' product.category.slug %}" class="btn btn-sm btn-outline-primary">
                View All <i class="bi bi-arrow-right ms-1"></i>
            </a>
        </div>

        <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-4">
            {% for p in related_products %} {% if p != product %}
            <div class="col">
                <div class="card h-100 product-card border-0 shadow-sm">
                    <div class="card-img-container p-3 bg-light text-center">
                        <a href="{{ p.get_absolute_url }}" class="text-decoration-none">
                            <img src="{{ p.image.url }}" class="card-img-top" alt="{{ p.title }}" style="height: 180px; object-fit: contain" />
                        </a>
                    </div>
                    <div class="card-body text-center">
                        <h5 class="card-title">
                            <a href="{{ p.get_absolute_url }}" class="text-decoration-none text-dark">{{ p.title }}</a>
                        </h5>
                        <p class="card-text fw-bold text-primary">${{ p.price }}</p>
                    </div>
                    <div class="card-footer bg-white border-0 text-center p-3">
                        <a href="{{ p.get_absolute_url }}" class="btn btn-outline-primary w-100">View Details</a>
                    </div>
                </div>
            </div>
            {% endif %} {% endfor %}
        </div>
    </div>
</div>

{% endblock %}
